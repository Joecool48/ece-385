
#include <stdio.h>
#include "../include/background.h"
#include "../include/init.h"
#include "../include/config.h"
#include <fstream>
#include <iostream>
#include <string>
#include <stdlib.h>
#include "../include/sim.h"
using namespace std;



int main ()
{
	std::cout << "Begin game" << std::endl;
	// Init the simulator
	Sim::initSim();
	Background * background = new Background ();
	Player * player = new Player(30, 30); // Make a player at 30, 30
	background->setPlayer(player); // Each contains the other
	player->setBackground(background);
	setBackgroundObjectWorld1(background); // Add the world 1 object colliders
	Keyboard::initKeyboard(); // Startup the keyboard
	char buff[256];
	while (true) {
		std::cout << "LOOPED in main" << std::endl;
		string str;
		Sim::scancode_file >> str;
		scancode = atoi((str == "" ? "0" : str).c_str());
		Keyboard::updateKeys();
		background->updateBackground(); // Function that does everything in the game.

		// Wait for hardware, and signal that you're done
		*SOFTWARE_DONE = 1;
		Sim::software_done_file.seekg(0, ios_base::beg);
		Sim::software_done_file << 1;

		Sim::hardware_done_file.seekg(0, ios_base::beg);
		getline(Sim::hardware_done_file, line);
		std::cout << buff << std::endl;
		*HARDWARE_DONE = atoi(buff);
		while (!(*HARDWARE_DONE)) { // Should update at 60ish fps
			Sim::hardware_done_file.seekg(0, ios_base::beg);
			Sim::hardware_done_file.getline(buff, 256);
			std::cout << "Buff print " << atoi(buff) << std::endl;
			*HARDWARE_DONE = atoi(buff);
		}
		*SOFTWARE_DONE = 0;
		Sim::software_done_file.seekg(0, ios_base::beg);
		Sim::software_done_file << 0;
	}
	return 0;
}
